{"version":3,"sources":["skmeans.js"],"names":["r","e","n","t","o","i","f","c","require","u","a","Error","code","p","exports","call","length","module","root","previous_skmeans","skmeans","window","eudist","v1","v2","len","sum","d","mandist","dist","sqrt","Math","abs","Distance","kmrand","data","k","map","ks","multi","floor","random","key","join","push","kmpp","fndist","distance","dists","lk","dsum","prs","min","Infinity","j","v","pr","cs","sort","b","rnd","idx","ClusterInit","absdist","MAX","init","val","test","point","Array","isArray","centroids","centroid","initial","maxit","fixedclusters","old","idxs","conv","it","vlen","count","z","fixedcluster_inds","Set","slice","fixedclusters_set","vsum","vect","h","has","ksj","sumj","oldj","cj","dif"],"mappings":"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","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){\n\"use strict\";\n\n(function() {\n  var root = this\n  var previous_skmeans = root.skmeans;\n\tvar skmeans = require('./main.js');\n\n\tif( typeof exports !== 'undefined' ) {\n    if( typeof module !== 'undefined' && module.exports ) {\n      exports = module.exports = skmeans;\n    }\n    exports.skmeans = skmeans;\n  }\n\n\tif(typeof window !== 'undefined') {\n    window.skmeans = skmeans;\n  }\n\n}).call(this);\n\n},{\"./main.js\":4}],2:[function(require,module,exports){\nmodule.exports = {\n\t/**\n\t * Euclidean distance\n\t */\n\teudist(v1,v2) {\n\t\tvar len = v1.length;\n\t\tvar sum = 0;\n\n\t\tfor(let i=0;i<len;i++) {\n\t\t\tvar d = (v1[i]||0) - (v2[i]||0);\n\t\t\tsum += d*d;\n\t\t}\n\t\t// Square root not really needed\n\t\treturn sum;\n\t},\n\n\tmandist(v1,v2) {\n\t\tvar len = v1.length;\n\t\tvar sum = 0, d = 0;\n\n\t\tfor(let i=0;i<len;i++) {\n\t\t\td = (v1[i]||0) - (v2[i]||0);\n\t\t\tsum += (d>=0)? d : -d;\n\t\t}\n\n\t\treturn sum;\n\t},\n\n\t/**\n\t * Unidimensional distance\n\t */\n\tdist(v1,v2,sqrt) {\n\t\tvar d = Math.abs(v1-v2);\n\t\treturn sqrt? d : d*d;\n\t}\n\n}\n\n},{}],3:[function(require,module,exports){\nconst\n\tDistance = require(\"./distance.js\"),\n\teudist = Distance.eudist,\n\tdist = Distance.dist;\n\nmodule.exports = {\n\tkmrand(data,k) {\n\t\tvar map = {}, ks = [], t = k<<2;\n\t\tvar len = data.length;\n\t\tvar multi = data[0].length>0;\n\n\t\twhile(ks.length<k && (t--)>0) {\n\t\t\tlet d = data[Math.floor(Math.random()*len)];\n\t\t\tlet key = multi? d.join(\"_\") : `${d}`;\n\t\t\tif(!map[key]) {\n\t\t\t\tmap[key] = true;\n\t\t\t\tks.push(d);\n\t\t\t}\n\t\t}\n\n\t\tif(ks.length<k) throw new Error(\"Error initializating clusters\");\n\t\telse return ks;\n\t},\n\n\t/**\n\t * K-means++ initial centroid selection\n\t */\n\tkmpp(data,k,fndist) {\n\t\tvar distance = fndist || (data[0].length? eudist : dist);\n\t\tvar ks = [], len = data.length;\n\t\tvar multi = data[0].length>0;\n\t\tvar map = {};\n\n\t\t// First random centroid\n\t\tvar c = data[Math.floor(Math.random()*len)];\n\t\tvar key = multi? c.join(\"_\") : `${c}`;\n\t\tks.push(c);\n\t\tmap[key] = true;\n\n\t\t// Retrieve next centroids\n\t\twhile(ks.length<k) {\n\t\t\t// Min Distances between current centroids and data points\n\t\t\tlet dists = [], lk = ks.length;\n\t\t\tlet dsum = 0, prs = [];\n\n\t\t\tfor(let i=0;i<len;i++) {\n\t\t\t\tlet min = Infinity;\n\t\t\t\tfor(let j=0;j<lk;j++) {\n\t\t\t\t\tlet dist = distance(data[i],ks[j]);\n\t\t\t\t\tif(dist<=min) min = dist;\n\t\t\t\t}\n\t\t\t\tdists[i] = min;\n\t\t\t}\n\n\t\t\t// Sum all min distances\n\t\t\tfor(let i=0;i<len;i++) {\n\t\t\t\tdsum += dists[i]\n\t\t\t}\n\n\t\t\t// Probabilities and cummulative prob (cumsum)\n\t\t\tfor(let i=0;i<len;i++) {\n\t\t\t\tprs[i] = {i:i, v:data[i],\tpr:dists[i]/dsum, cs:0}\n\t\t\t}\n\n\t\t\t// Sort Probabilities\n\t\t\tprs.sort((a,b)=>a.pr-b.pr);\n\n\t\t\t// Cummulative Probabilities\n\t\t\tprs[0].cs = prs[0].pr;\n\t\t\tfor(let i=1;i<len;i++) {\n\t\t\t\tprs[i].cs = prs[i-1].cs + prs[i].pr;\n\t\t\t}\n\n\t\t\t// Randomize\n\t\t\tlet rnd = Math.random();\n\n\t\t\t// Gets only the items whose cumsum >= rnd\n\t\t\tlet idx = 0;\n\t\t\twhile(idx<len-1 && prs[idx++].cs<rnd);\n\t\t\tks.push(prs[idx-1].v);\n\t\t\t/*\n\t\t\tlet done = false;\n\t\t\twhile(!done) {\n\t\t\t\t// this is our new centroid\n\t\t\t\tc = prs[idx-1].v\n\t\t\t\tkey = multi? c.join(\"_\") : `${c}`;\n\t\t\t\tif(!map[key]) {\n\t\t\t\t\tmap[key] = true;\n\t\t\t\t\tks.push(c);\n\t\t\t\t\tdone = true;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tidx++;\n\t\t\t\t}\n\t\t\t}\n\t\t\t*/\n\t\t}\n\n\t\treturn ks;\n\t}\n\n}\n\n},{\"./distance.js\":2}],4:[function(require,module,exports){\n/*jshint esversion: 6 */\n\nconst\n\tDistance = require(\"./distance.js\"),\n\tClusterInit = require(\"./kinit.js\"),\n\teudist = Distance.eudist,\n\tmandist = Distance.mandist,\n\tabsdist = Distance.dist,\n\tkmrand = ClusterInit.kmrand,\n\tkmpp = ClusterInit.kmpp;\n\nconst MAX = 10000;\n\n/**\n * Inits an array with values\n */\nfunction init(len,val,v) {\n\tv = v || [];\n\tfor(let i=0;i<len;i++) v[i] = val;\n\treturn v;\n}\n\nfunction test(point, fndist) {\n\tlet\n\t\tmulti = Array.isArray(point),\n\t\tks = this.centroids,\n\t\tk = ks.length;\n\n\t// For each value in data, find the nearest centroid\n\tlet min = Infinity, idx = 0;\n\tfor(let j=0;j<k;j++) {\n\t\t// Custom, Multidimensional or unidimensional\n\t\tlet dist =\tfndist? fndist(point,ks[j]) :\n\t\t\t\t\t\t\t\tmulti? eudist(point,ks[j]) :\n\t\t\t\t\t\t\t\tMath.abs(point-ks[j]);\n\n\t\tif(dist<=min) {\n\t\t\tmin = dist;\n\t\t\tidx = j;\n\t\t}\n\t}\n\n\treturn {\n\t\tidx, centroid:ks[idx]\n\t}\n}\n\nfunction skmeans(data,k,initial,maxit,fndist,fixedclusters) {\n\t// fixedclusters looks like [0, 1, 0, 0, -1, -1, -1], e.g.,\n\t// to indicate that 0, 2, 3 should stay clustered and \n\t// 1 should stay clustered and the last three data points\n\t// should go in some cluster, either one of the first two\n\t// or a new one\n\tvar ks = [], old = [], idxs = [], dist = [];\n\tvar conv = false, it = maxit || MAX;\n\tvar len = data.length, vlen = data[0].length; \n\tvar count = [];\n\n\tif(!initial) {\n\t\tlet idxs = {}, z=0;\n\t\twhile(ks.length<k) {\n\t\t\tlet idx = Math.floor(Math.random()*len);\n\t\t\tif(!idxs[idx]) {\n\t\t\t\tidxs[idx] = true;\n\t\t\t\tks[z++] = data[idx];\n\t\t\t}\n\t\t}\n\t}\n\telse if(initial==\"kmrand\") {\n\t\tks = kmrand(data,k);\n\t}\n\telse if(initial==\"kmpp\") {\n\t\tks = kmpp(data,k,fndist);\n\t}\n\telse {\n\t\tks = initial;\n\t}\n\t\n\t// fix centers based on pre-specified clusters\n\tif(fixedclusters) {\n\t\t// assign the fixed points to their clusters, permanently\n\t\tfor(let i=0;i<len;i++) {\n\t\t\tif (fixedclusters[i] != -1) {\n\t\t\t\tidxs[i] = fixedclusters[i]; \n\t\t\t}\n\t\t}\n\t\t\n\t\t// which clusters are fixed:\n\t\tvar fixedcluster_inds = [...new Set(fixedclusters)].sort().slice(1);\n\t\tvar fixedclusters_set = new Set(fixedcluster_inds);\n\t\t\n\t\t// set up zero vectors to store means\n\t\tvar sum = []; \n\t\tfor(let j=0;j<k;j++) {\n\t\t\t\tsum[j] = init(vlen,0,sum[j]);\n\t\t}\n\n\t\t// Sum values and count for each centroid\n\t\tfor(let i=0;i<len;i++) {\n\t\t\tif (fixedclusters[i] != -1) {\n\t\t\t\tlet\tidx = fixedclusters[i],\t\t// Centroid for that item\n\t\t\t\t\t\tvsum = sum[idx],\t// Sum values for this centroid\n\t\t\t\t\t\tvect = data[i];\t\t// Current vector\n\n\t\t\t\t// Accumulate value on the centroid for current vector\n\t\t\t\tfor(let h=0;h<vlen;h++) {\n\t\t\t\t\tvsum[h] += vect[h];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t// Calculate the average for each centroid\n\t\tconv = true;\n\t\tfor(let j=0;j<k;j++) {\n\t\t\tif (fixedclusters_set.has(j)) {\n\t\t\t\tlet ksj = ks[j],\t\t// Current centroid\n\t\t\t\t\t\tsumj = sum[j],\t// Accumulated centroid values\n\t\t\t\t\t\toldj = old[j], \t// Old centroid value\n\t\t\t\t\t\tcj = count[j];\t// Number of elements for this centroid\n\t\t\t\tfor(let h=0;h<vlen;h++) {\n\t\t\t\t\tksj[h] = (sumj[h])/(cj) || 0;\t// centroid\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\telse {\n\t\tvar fixedclusters = init(len, -1);\n\t\tvar fixedcluster_inds = [];\n\t\tvar fixedclusters_set = new Set();\n\t}\n\n\tdo {\n\t\t// Reset k count\n\t\tinit(k,0,count);\n\n\t\t// For each non-fixed value in data, find the nearest centroid\n\t\tfor(let i=0;i<len;i++) {\n\t\t\tlet min = Infinity, idx = 0;\n\t\t\tif (fixedclusters[i] == -1) { // -1 indicates a non-fixed point\n\t\t\t\tfor(let j=0;j<k;j++) {\n\t\t\t\t\tvar dist =\tfndist ? fndist(data[i],ks[j]) : eudist(data[i],ks[j]);\n\t\t\t\t\t\n\t\t\t\t\tif(dist<=min) {\n\t\t\t\t\t\tmin = dist;\n\t\t\t\t\t\tidx = j;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\telse {\n\t\t\t\tidx = fixedclusters[i]; \n\t\t\t}\n\t\t\tidxs[i] = idx;\t// Index of the selected centroid for that value\n\t\t\tcount[idx]++;\t\t// Number of values for this centroid\n\t\t}\n\n\t\t// Recalculate centroids\n\t\tvar sum = [], old = [], dif = 0;\n\t\tfor(let j=0;j<k;j++) {\n\t\t\t\tsum[j] = init(vlen,0,sum[j]);\n\t\t\t\told[j] = ks[j];\n\t\t}\n\t\t\n\t\tfor(let j=0;j<k;j++) {\n\t\t\tif (!fixedclusters_set.has(j)) {\n\t\t\t\tks[j] = [];\n\t\t\t}\n\t\t}\n\n\t\t// Sum values and count for each centroid\n\t\tfor(let i=0;i<len;i++) {\n\t\t\tlet\tidx = idxs[i],\t\t// Centroid for that item\n\t\t\t\t\tvsum = sum[idx],\t// Sum values for this centroid\n\t\t\t\t\tvect = data[i];\t\t// Current vector\n\n\t\t\t// Accumulate value on the centroid for current vector\n\t\t\tfor(let h=0;h<vlen;h++) {\n\t\t\t\tvsum[h] += vect[h];\n\t\t\t}\n\t\t}\n\t\t// Calculate the average for each centroid\n\t\tconv = true;\n\t\tfor(let j=0;j<k;j++) {\n\t\t\tlet ksj = ks[j],\t\t// Current centroid\n\t\t\t\t\tsumj = sum[j],\t// Accumulated centroid values\n\t\t\t\t\toldj = old[j], \t// Old centroid value\n\t\t\t\t\tcj = count[j];\t// Number of elements for this centroid\n\n\t\t\t// New average\n\t\t\tfor(let h=0;h<vlen;h++) {\n\t\t\t\tksj[h] = (sumj[h])/(cj) || 0;\t// New centroid\n\t\t\t}\n\n\t\t\t// Find if centroids have moved\n\t\t\tif(conv) {\n\t\t\t\tfor(let h=0;h<vlen;h++) {\n\t\t\t\t\tif(oldj[h]!=ksj[h]) {\n\t\t\t\t\t\tconv = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconv = conv || (--it<=0);\n\t} while(!conv);\n\n\treturn {\n\t\tit : (maxit || MAX) - it,\n\t\tk : k,\n\t\tidxs : idxs,\n\t\tcentroids : ks,\n\t\ttest : test\n\t};\n}\n\nmodule.exports = skmeans;\n\n},{\"./distance.js\":2,\"./kinit.js\":3}]},{},[1]);\n"],"file":"skmeans.js"}